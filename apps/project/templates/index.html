[[extend 'layout.html']]

<style>
   [v-cloak] {
      display: none;
   }
</style>


<div class="section"id="vue-target" v-cloak>
   <div class="container block">
      <div class="tile is-ancestor">
         <div class="tile is-parent has-text-right">
            <div class="tile is-child has-text-right">
               <a class="button" href="[[=URL('profile', cur_user_id)]]">
                  <span class="icon"><i class="fa fa-fw fa-user"></i></span><span>Profile</span>
               </a>
            </div>
         </div>
         <div class="tile is-vertical is-parent is-8" >
            <h1 class="title">Dashboard</h1>
            <div v-if="add_mode" class="tile is-child">
               <div class="form">
                  <div class="field">
                     <textarea class="textarea" placeholder="Enter new post here" v-model="add_post"></textarea>
                  </div>

                  <div class="field">
                     <div class="control">
                        <input type="submit" @click="add_posts" value="Post" class="button is-primary">
                        <input type="submit" @click="set_add_status(false)" value="Cancel" class="button is-warning">
                     </div>
                  </div>
               </div>
            </div>
            <div v-if="!add_mode" class="tile is-child">
               <button @click="set_add_status(true)" class="button is-primary">
                  <i class="fa fa-plus fa-fw"></i>
               </button>
            </div>

            <div class="tile is-child box" style="background-color:rgba(224,224,224,0.418)"
               v-for="r in rows.slice().reverse()">

               <p class="has-text-black">{{r.post}}</p>
               <p class="has-text-grey">{{r.first_name}} {{r.last_name}}</p>

               <span @mouseout="clear_names(r._idx)" style="color:rgba(1, 65, 161, 0.63)">
                  <span @mouseover="check_likes(r._idx)" @click="set_likes(r._idx)">
                     <i class="fa fa-2x fa-flip-horizontal"
                        :class="{'fa-thumbs-o-up':!r._like, 'fa-thumbs-up':r._like}"></i>
                  </span>
                  <span @mouseover="check_dislikes(r._idx)" @click="set_dislikes(r._idx)">
                     <i class="fa fa-2x" :class="{'fa-thumbs-o-down':!r._dislike, 'fa-thumbs-down':r._dislike}"></i>
                  </span>
               </span>

               <span v-if="r.lhover" style="color:rgba(1, 65, 161, 0.63)">
                  {{r._lname}}
               </span>
               <span v-if="r.dhover" style="color:rgba(1, 65, 161, 0.63)">
                  {{r._dname}}
               </span>
               <span v-if="r.email === cur_user">
                  <button @click="delete_posts(r._idx)" class="button is-danger" style="float:right;">
                     <i class="fa fa-trash"></i>
                  </button>
               </span>

            </div>
         </div>
         <div class="tile is-parent is-vertical is-2">
            <div class="control block">
               <input class="input" type="text" v-model="query" @keyup="search" placeholder="Search"/>
             </div>
             <div class="tile is-child is-12" v-for="r in results">
                  <a v-bind:href="'[[=URL()]]profile/' + r.id">{{r.first_name}} {{r.last_name}}</a>
             </div>
         </div>
      </div>
   </div>
</div>

[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
   let add_post_url = "[[=XML(add_post_url)]]";
   let load_posts_url = "[[=XML(load_posts_url)]]";
   let delete_post_url = "[[=XML(delete_post_url)]]";
   let load_likes_url = "[[=XML(load_likes_url)]]";
   let get_likes_url = "[[=XML(get_likes_url)]]";
   let get_dislikes_url = "[[=XML(get_dislikes_url)]]";
   let search_url = "[[=XML(search_url)]]";

   let cur_user = "[[ =cur_user ]]";
   let cur_user_name = "[[ =cur_user_name ]]";
   let cur_user_id = "[[ =cur_user_id ]]";
</script>
<script src="js/index.js"></script>
[[end]]