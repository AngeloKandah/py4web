[[extend 'layout.html']]

<style>
   [v-cloak] {
      display: none;
   }
</style>

<style>
   .card_color {
      background-color: rgb(154, 207, 154);
   }
</style>

<div class="section" id="vue-target" v-cloak>
   <div class="container block">
      <div class="tile is-ancestor">
         <div class="tile is-parent has-text-right">
            <div class="tile is-child has-text-right">
               <a class="button" href="[[=URL('profile', cur_user_id)]]">
                  <span class="icon"><i class="fa fa-fw fa-user"></i></span><span>Profile</span>
               </a>
            </div>
         </div>
         <div class="tile is-vertical is-parent is-8">
            <h1 class="title">Dashboard</h1>
            <div v-if="add_mode" class="tile is-child">
               <div class="form">
                  <div class="field">
                     <textarea class="textarea" placeholder="Enter new post here" v-model="add_post"></textarea>
                  </div>

                  <div class="field">
                     <div class="control">
                        <input type="submit" @click="add_posts" value="Post" class="button is-primary">
                        <input type="submit" @click="set_add_status(false)" value="Cancel" class="button is-warning">
                     </div>
                  </div>
               </div>
            </div>
            <div v-if="!add_mode" class="tile is-child">
               <button @click="set_add_status(true)" class="button is-primary">
                  <i class="fa fa-plus fa-fw"></i>
               </button>
            </div>

            <div class="tile is-child box" style="background-color:rgba(224,224,224,0.418); word-wrap: break-word;"
               v-for="r in rows.slice().reverse()">
               <article class="media">
                  <figure class="media-left">
                     <p class="image is-48x48">
                        <img :src="r.picture">
                     </p>
                  </figure>
                  <div class="media-content">
                     <div class="content">
                        <p>
                           <strong>{{r.first_name}} {{r.last_name}}</strong>
                           <br>
                           {{r.post}}
                           <br>
                           <span style="color:rgba(1, 65, 161, 0.63)">

                              <span @click="set_likes(r._idx)">
                                 <i class="fa fa-2x fa-flip-horizontal"
                                    :class="{'fa-thumbs-o-up':!r._like, 'fa-thumbs-up':r._like}"></i>
                              </span>
                              <button class="button is-normal modal-button"
                                 style="background-color:transparent;border:none;outline:none;padding:2px 5px 2px 5px"
                                 @click="show_names('liked', r._idx)">
                                 {{r._lnum}}
                              </button>

                              <span @click="set_dislikes(r._idx)">
                                 <i class="fa fa-2x"
                                    :class="{'fa-thumbs-o-down':!r._dislike, 'fa-thumbs-down':r._dislike}"></i>
                              </span>
                              <button class="button is-normal modal-button"
                                 style="background-color:transparent;border:none;outline:none;padding:2px 5px 2px 5px"
                                 @click="show_names('disliked', r._idx)">
                                 {{r._dnum}}
                              </button>

                           </span>

                           <button class="button" @click="set_comment_status(true, r._idx)"
                              style="background-color:transparent;border:none;outline:none;padding:2px 5px 2px 5px;color:rgba(1, 65, 161, 0.63)">
                              <i class="fa fa-comments"></i><span>&nbsp;Comment</span>
                           </button>

                           <span v-if="r.email === cur_user">
                              <button @click="delete_posts(r._idx)" class="button"
                                 style="float:right;background-color:transparent;border:none;outline:none">
                                 <i class="fa fa-trash"></i>
                              </button>
                           </span>
                        </p>

                     </div>
                     <div v-if="r.commenting">
                        <div v-if="add_comment_mode" class="media">
                           <div class="media-content">
                              <div class="content">
                                 <div class="form">
                                    <div class="field">
                                       <textarea class="textarea" placeholder="Enter new comment here"
                                          v-model="add_comment"></textarea>
                                    </div>

                                    <div class="field">
                                       <div class="control">
                                          <input type="submit" @click="add_comments(r._idx,r.id)" value="Comment"
                                             class="button is-primary">
                                          <input type="submit" @click="set_comment_status(false,r._idx)" value="Cancel"
                                             class="button is-warning">
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>

                     <article class="media" v-for="c in r.comments">
                        <figure class="media-left">
                           <p class="image is-48x48">
                              <img :src="c[0].picture">
                           </p>
                        </figure>
                        <div class="media-content">
                           <div class="content">
                              <p>
                                 <strong>{{c[0].first_name}} {{c[0].last_name}}</strong>
                                 <br>
                                 {{c[0].comment}}
                                 <span v-if="c[0].email === cur_user">
                                    <button @click="delete_comments(r._idx,c[0].id)" class="button"
                                       style="float:right;background-color:transparent;border:none;outline:none">
                                       <i class="fa fa-trash"></i>
                                    </button>
                                 </span>
                              </p>

                           </div>

                        </div>
                     </article>
                  </div>
               </article>
            </div>
         </div>
         <div class="tile is-parent is-vertical is-2">
            <div class="control block">
               <input class="input" type="text" v-model="query" @keyup="search" placeholder="Search" />
            </div>
            <div class="tile is-child is-12" v-for="r in results">
               <a v-bind:href="'[[=URL()]]profile/' + r.id">{{r.name}}</a>
            </div>
         </div>
      </div>
   </div>

   <div class="modal" :class="{'is-active':show_modal}">
      <div class="modal-background"></div>
      <div class="modal-card">
         <header class="modal-card-head has-background-success-dark">
            <p class="modal-card-title ">Users that have {{type}} this:</p>
            <button class="delete" aria-label="close" @click="close_modal"></button>
         </header>
         <section class="modal-card-body card_color">
            <div class="tile is-ancestor" v-for="n in names">
               <div class="tile is-parent"
                  style="display:flex;align-items:center;width:100%;justify-content:space-between">
                  {{n.name}}
                  <a v-bind:href="'[[=URL()]]profile/' + n.id" class="button"
                     style="background-color:transparent;border:none;outline:none;">
                     <span class="icon"><i class="fa fa-fw fa-user"></i></span><span>Profile</span>
                  </a>
               </div>
            </div>
         </section>
         <footer class="modal-card-foot has-background-success-dark"></footer>
      </div>
   </div>
</div>

[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
   let add_post_url = "[[=XML(add_post_url)]]";
   let load_posts_url = "[[=XML(load_posts_url)]]";
   let delete_post_url = "[[=XML(delete_post_url)]]";
   let load_likes_url = "[[=XML(load_likes_url)]]";
   let get_likes_url = "[[=XML(get_likes_url)]]";
   let search_url = "[[=XML(search_url)]]";
   let add_comment_url = "[[=XML(add_comment_url)]]";
   let delete_comment_url = "[[=XML(delete_comment_url)]]";

   let cur_user = "[[ =cur_user ]]";
   let cur_user_name = "[[ =cur_user_name ]]";
   let cur_user_id = "[[ =cur_user_id ]]";
</script>
<script src="js/index.js"></script>
[[end]]